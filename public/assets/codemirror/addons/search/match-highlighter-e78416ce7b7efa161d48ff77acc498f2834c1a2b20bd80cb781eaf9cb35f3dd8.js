!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror"),require("./matchesonscrollbar")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","./matchesonscrollbar"],t):t(CodeMirror)}(function(t){"use strict";function e(t){this.options={};for(var e in c)this.options[e]=(t&&t.hasOwnProperty(e)?t:c)[e];this.overlay=this.timeout=null,this.matchesonscroll=null}function o(t){var e=t.state.matchHighlighter;clearTimeout(e.timeout),e.timeout=setTimeout(function(){i(t)},e.options.delay)}function n(t,e,o,n){var r=t.state.matchHighlighter;if(t.addOverlay(r.overlay=a(e,o,n)),r.options.annotateScrollbar&&t.showMatchesOnScrollbar){var i=o?new RegExp("\\b"+e+"\\b"):e;r.matchesonscroll=t.showMatchesOnScrollbar(i,!0,{className:"CodeMirror-selection-highlight-scrollbar"})}}function r(t){var e=t.state.matchHighlighter;e.overlay&&(t.removeOverlay(e.overlay),e.overlay=null,e.matchesonscroll&&(e.matchesonscroll.clear(),e.matchesonscroll=null))}function i(t){t.operation(function(){var e=t.state.matchHighlighter;if(r(t),!t.somethingSelected()&&e.options.showToken){for(var o=!0===e.options.showToken?/[\w$]/:e.options.showToken,i=t.getCursor(),s=t.getLine(i.line),a=i.ch,c=a;a&&o.test(s.charAt(a-1));)--a;for(;c<s.length&&o.test(s.charAt(c));)++c;return void(a<c&&n(t,s.slice(a,c),o,e.options.style))}var h=t.getCursor("from"),u=t.getCursor("to");if(h.line==u.line&&(!e.options.wordsOnly||l(t,h,u))){var g=t.getRange(h,u);e.options.trim&&(g=g.replace(/^\s+|\s+$/g,"")),g.length>=e.options.minChars&&n(t,g,!1,e.options.style)}})}function l(t,e,o){if(null!==t.getRange(e,o).match(/^\w+$/)){if(e.ch>0){var n={line:e.line,ch:e.ch-1},r=t.getRange(n,e);if(null===r.match(/\W/))return!1}if(o.ch<t.getLine(e.line).length){var n={line:o.line,ch:o.ch+1},r=t.getRange(o,n);if(null===r.match(/\W/))return!1}return!0}return!1}function s(t,e){return!(t.start&&e.test(t.string.charAt(t.start-1))||t.pos!=t.string.length&&e.test(t.string.charAt(t.pos)))}function a(t,e,o){return{token:function(n){if(n.match(t)&&(!e||s(n,e)))return o;n.next(),n.skipTo(t.charAt(0))||n.skipToEnd()}}}var c={style:"matchhighlight",minChars:2,delay:100,wordsOnly:!1,annotateScrollbar:!1,showToken:!1,trim:!0};t.defineOption("highlightSelectionMatches",!1,function(n,l,s){s&&s!=t.Init&&(r(n),clearTimeout(n.state.matchHighlighter.timeout),n.state.matchHighlighter=null,n.off("cursorActivity",o)),l&&(n.state.matchHighlighter=new e(l),i(n),n.on("cursorActivity",o))})});